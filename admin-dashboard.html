<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Add Questions</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
</head>

<body class="signup-body-black">

  <div class="start-card animate-card">
    <h2 class="home-title">Add New Questions</h2>
    <p class="home-subtitle">Enter up to 5 questions and their options</p>

    <div id="questionForms"></div> <!-- Question Forms will be dynamically added -->

    <button class="btn-start-quiz" id="submitQuestionsBtn">Submit Questions</button>

    <p class="home-subtitle" style="margin-top: 15px;">
      <a href="admin-dashboard.html">Back to Dashboard</a>
    </p>
  </div>

  <script>
    // Initialize Supabase client
    const SUPABASE_URL = 'YOUR_SUPABASE_URL';  // Replace with your Supabase URL
    const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';  // Replace with your Supabase anon/public key
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let questionCount = 1; // Track number of questions added
    const MAX_QUESTIONS = 5; // Limit to 5 questions

    // Function to dynamically add question form
    function addQuestionForm() {
      const formHtml = `
        <div class="question-form" id="questionForm${questionCount}">
          <h3>Question ${questionCount}</h3>
          <input type="text" id="question${questionCount}" placeholder="Question" required />
          <input type="text" id="optionA${questionCount}" placeholder="Option A" required />
          <input type="text" id="optionB${questionCount}" placeholder="Option B" required />
          <input type="text" id="optionC${questionCount}" placeholder="Option C" required />
          <input type="text" id="optionD${questionCount}" placeholder="Option D" required />
          <select id="correctOption${questionCount}" required>
            <option value="">Select Correct Option</option>
            <option value="a">Option A</option>
            <option value="b">Option B</option>
            <option value="c">Option C</option>
            <option value="d">Option D</option>
          </select>
        </div>
      `;

      document.getElementById('questionForms').insertAdjacentHTML('beforeend', formHtml);
      questionCount++;

      // Stop adding more questions if the limit is reached
      if (questionCount > MAX_QUESTIONS) {
        document.getElementById('submitQuestionsBtn').style.display = 'block';
      }
    }

    // Add 5 question forms dynamically when the page loads
    for (let i = 0; i < MAX_QUESTIONS; i++) {
      addQuestionForm();
    }

    // Submit Questions to Supabase
    async function submitQuestions() {
      const questions = [];

      for (let i = 1; i <= MAX_QUESTIONS; i++) {
        const questionText = document.getElementById(`question${i}`).value;
        const optionA = document.getElementById(`optionA${i}`).value;
        const optionB = document.getElementById(`optionB${i}`).value;
        const optionC = document.getElementById(`optionC${i}`).value;
        const optionD = document.getElementById(`optionD${i}`).value;
        const correctOption = document.getElementById(`correctOption${i}`).value;

        if (!questionText || !optionA || !optionB || !optionC || !optionD || !correctOption) {
          alert("Please fill all fields for all questions.");
          return;
        }

        questions.push({
          question: questionText,
          option_a: optionA,
          option_b: optionB,
          option_c: optionC,
          option_d: optionD,
          correct_option: correctOption,
        });
      }

      // Insert questions into Supabase
      const { data, error } = await supabase.from('questions').insert(questions);
      if (error) {
        alert("Error adding questions: " + error.message);
        return;
      }

      // Successfully added, redirect to quiz page
      alert("Questions added successfully!");
      window.location.href = "quiz.html"; // Redirect to quiz page
    }

    document.getElementById('submitQuestionsBtn').addEventListener('click', submitQuestions);
  </script>
</body>
</html>
